<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>My Profile ‚Äî Binary Craft</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
    <link rel="stylesheet" href="css/global.css" />
    <style>
        body {
            background: var(--bg-primary);
            font-family: var(--font-primary);
            color: var(--text-primary);
        }

        .profile-page {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar */
        .dash-sidebar {
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-right: 1px solid var(--border);
            position: fixed;
            top: 0;
            left: 0;
            bottom: 0;
            width: 280px;
            z-index: 100;
            display: flex;
            flex-direction: column;
            transition: var(--transition);
        }

        .sidebar-header {
            padding: 32px 24px;
            border-bottom: 1px solid var(--border);
        }

        .sidebar-logo {
            display: flex;
            align-items: center;
            gap: 12px;
            text-decoration: none;
            color: var(--text-primary);
        }

        .sidebar-logo-icon {
            width: 42px;
            height: 42px;
            background: var(--grad-primary);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            font-weight: 900;
            box-shadow: var(--shadow-glow);
        }

        .sidebar-logo-name {
            font-family: var(--font-heading);
            font-weight: 800;
            font-size: 18px;
            letter-spacing: -0.02em;
        }

        .sidebar-logo-sub {
            font-size: 11px;
            color: var(--primary);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .sidebar-user {
            margin: 24px 16px;
            padding: 16px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .sidebar-avatar {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            background: var(--grad-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            font-weight: 700;
            color: #fff;
            box-shadow: 0 0 15px rgba(59, 130, 246, 0.3);
        }

        .sidebar-nav {
            flex: 1;
            padding: 0 16px;
            overflow-y: auto;
        }

        .sidebar-section {
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--text-muted);
            padding: 20px 12px 10px;
        }

        .sidebar-link {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            color: var(--text-secondary);
            text-decoration: none;
            border-radius: var(--radius-sm);
            font-size: 14px;
            font-weight: 500;
            transition: var(--transition-fast);
            margin-bottom: 4px;
        }

        .sidebar-link i {
            width: 20px;
            font-size: 16px;
            text-align: center;
            opacity: 0.7;
        }

        .sidebar-link:hover {
            background: rgba(255, 255, 255, 0.05);
            color: var(--text-primary);
        }

        .sidebar-link.active {
            background: var(--primary-glow);
            color: var(--primary);
            font-weight: 600;
        }

        .sidebar-footer {
            padding: 20px 16px;
            border-top: 1px solid var(--border);
        }

        /* Main Content */
        .profile-main {
            margin-left: 280px;
            flex: 1;
            padding: 40px;
            max-width: 1000px;
        }

        .profile-main h1 {
            font-family: var(--font-heading);
            font-size: 32px;
            font-weight: 800;
            letter-spacing: -0.02em;
            margin-bottom: 8px;
        }

        .profile-tabs {
            display: flex;
            gap: 8px;
            padding: 4px;
            background: var(--bg-secondary);
            border-radius: var(--radius-md);
            margin-bottom: 40px;
            width: fit-content;
            border: 1px solid var(--border);
        }

        .tab-btn {
            padding: 10px 24px;
            border: none;
            background: none;
            color: var(--text-muted);
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            border-radius: calc(var(--radius-md) - 2px);
            transition: var(--transition-fast);
        }

        .tab-btn:hover {
            color: var(--text-primary);
        }

        .tab-btn.active {
            background: var(--bg-card);
            color: var(--primary);
            box-shadow: var(--shadow-sm);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.4s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .profile-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            padding: 40px;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        .profile-avatar-section {
            display: flex;
            align-items: center;
            gap: 32px;
            margin-bottom: 40px;
            padding-bottom: 32px;
            border-bottom: 1px solid var(--border);
        }

        .avatar-big {
            width: 96px;
            height: 96px;
            border-radius: 20px;
            background: var(--grad-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            font-weight: 800;
            color: #fff;
            box-shadow: var(--shadow-glow);
            flex-shrink: 0;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
        }

        .form-group {
            margin-bottom: 24px;
        }

        .form-label {
            display: block;
            font-size: 13px;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .dash-sidebar {
                width: 80px;
            }

            .sidebar-logo-name,
            .sidebar-logo-sub,
            .sidebar-user-name,
            .sidebar-user-email,
            .sidebar-link span,
            .sidebar-section {
                display: none;
            }

            .sidebar-user {
                padding: 10px;
                margin: 20px 10px;
                justify-content: center;
            }

            .sidebar-link {
                justify-content: center;
                padding: 12px;
            }

            .profile-main {
                margin-left: 80px;
            }
        }

        @media (max-width: 768px) {
            .profile-main {
                padding: 24px;
            }

            .form-row {
                grid-template-columns: 1fr;
                gap: 0;
            }

            .profile-avatar-section {
                flex-direction: column;
                align-items: flex-start;
                text-align: left;
                gap: 20px;
            }

            .profile-tabs {
                width: 100%;
                overflow-x: auto;
            }
        }
    </style>
</head>

<body>
    <div class="profile-page">
        <!-- Sidebar -->
        <aside class="dash-sidebar" id="sidebar">
            <div class="sidebar-header">
                <a href="index.html" class="sidebar-logo">
                    <div class="sidebar-logo-icon">BC</div>
                    <div>
                        <div class="sidebar-logo-name">Binary Craft</div>
                        <div class="sidebar-logo-sub">User Panel</div>
                    </div>
                </a>
            </div>
            <div class="sidebar-user" id="sidebar-user">
                <div class="sidebar-avatar" id="sidebar-avatar">?</div>
                <div>
                    <div class="sidebar-user-name" id="sidebar-name">Loading...</div>
                    <div class="sidebar-user-email" id="sidebar-email">...</div>
                </div>
            </div>
            <nav class="sidebar-nav">
                <div class="sidebar-section">Main</div>
                <a href="dashboard.html" class="sidebar-link"><i class="fas fa-tachometer-alt"></i>
                    <span>Dashboard</span></a>
                <a href="profile.html" class="sidebar-link active"><i class="fas fa-user"></i> <span>My
                        Profile</span></a>
                <a href="cart.html" class="sidebar-link"><i class="fas fa-shopping-cart"></i> <span>Cart</span></a>
                <div class="sidebar-section">Orders</div>
                <a href="order-history.html" class="sidebar-link"><i class="fas fa-box"></i> <span>Order
                        History</span></a>
                <div class="sidebar-section">Account</div>
                <a href="profile.html#security" class="sidebar-link"><i class="fas fa-lock"></i> <span>Change
                        Password</span></a>
                <a href="index.html" class="sidebar-link"><i class="fas fa-globe"></i> <span>Visit Website</span></a>
                <div class="sidebar-section">Other</div>
                <a href="services.html" class="sidebar-link"><i class="fas fa-cogs"></i> <span>Browse
                        Services</span></a>
                <a href="products.html" class="sidebar-link"><i class="fas fa-store"></i> <span>Browse
                        Products</span></a>
            </nav>
            <div class="sidebar-footer">
                <button class="btn btn-danger btn-sm" style="width:100%;justify-content:center" onclick="Auth.logout()">
                    <i class="fas fa-sign-out-alt"></i> <span>Logout</span>
                </button>
            </div>
        </aside>

        <main class="profile-main">
            <div style="margin-bottom:28px">
                <h1 style="font-size:28px;font-weight:800;margin-bottom:4px">My Profile</h1>
                <p style="color:var(--text-muted);font-size:14px">Manage your personal information and security settings
                </p>
            </div>

            <div class="profile-tabs">
                <button class="tab-btn active" onclick="switchTab('info', this)">Personal Info</button>
                <button class="tab-btn" onclick="switchTab('address', this)">Address</button>
                <button class="tab-btn" id="security-tab" onclick="switchTab('security', this)">Change Password</button>
            </div>

            <!-- Personal Info Tab -->
            <div class="tab-content active" id="tab-info">
                <div class="profile-card">
                    <div id="profile-alert"></div>
                    <div class="profile-avatar-section">
                        <div class="avatar-big" id="profile-avatar">?</div>
                        <div>
                            <h3 style="font-size:20px;font-weight:800;margin-bottom:4px" id="avatar-name">...</h3>
                            <p style="color:var(--text-muted);font-size:14px" id="avatar-email">...</p>
                            <p style="color:var(--primary);font-size:13px;margin-top:6px">Member since <span
                                    id="member-since">...</span></p>
                        </div>
                    </div>
                    <form id="profile-form" novalidate>
                        <div class="form-row">
                            <div class="form-group"><label class="form-label">Full Name</label><input type="text"
                                    class="form-input" id="pf-name" /></div>
                            <div class="form-group"><label class="form-label">Phone</label><input type="tel"
                                    class="form-input" id="pf-phone" placeholder="+880..." /></div>
                        </div>
                        <div class="form-group"><label class="form-label">Email (read-only)</label><input type="email"
                                class="form-input" id="pf-email" readonly style="opacity:0.6" /></div>
                        <button type="submit" class="btn btn-primary" id="save-profile-btn"><i class="fas fa-save"></i>
                            Save Changes</button>
                    </form>
                </div>
            </div>

            <!-- Address Tab -->
            <div class="tab-content" id="tab-address">
                <div class="profile-card">
                    <div id="address-alert"></div>
                    <h3 style="font-size:17px;font-weight:700;margin-bottom:24px">üìç Shipping Address</h3>
                    <form id="address-form">
                        <div class="form-group"><label class="form-label">Street Address</label><input type="text"
                                class="form-input" id="addr-street" placeholder="House no, street name..." /></div>
                        <div class="form-row">
                            <div class="form-group"><label class="form-label">City</label><input type="text"
                                    class="form-input" id="addr-city" /></div>
                            <div class="form-group"><label class="form-label">State/Division</label><input type="text"
                                    class="form-input" id="addr-state" /></div>
                        </div>
                        <div class="form-row">
                            <div class="form-group"><label class="form-label">ZIP Code</label><input type="text"
                                    class="form-input" id="addr-zip" /></div>
                            <div class="form-group"><label class="form-label">Country</label><select class="form-input"
                                    id="addr-country">
                                    <option value="BD">Bangladesh</option>
                                    <option value="US">United States</option>
                                    <option value="GB">United Kingdom</option>
                                    <option value="IN">India</option>
                                    <option value="CA">Canada</option>
                                    <option value="AU">Australia</option>
                                </select></div>
                        </div>
                        <button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> Save Address</button>
                    </form>
                </div>
            </div>

            <!-- Security Tab -->
            <div class="tab-content" id="tab-security">
                <div class="profile-card">
                    <div id="security-alert"></div>
                    <h3 style="font-size:17px;font-weight:700;margin-bottom:24px"><i class="fas fa-lock"></i> Change
                        Password</h3>
                    <form id="password-form">
                        <div class="form-group"><label class="form-label">Current Password</label><input type="password"
                                class="form-input" id="cur-pwd" required /></div>
                        <div class="form-group"><label class="form-label">New Password</label><input type="password"
                                class="form-input" id="new-pwd" required /></div>
                        <div class="form-group"><label class="form-label">Confirm New Password</label><input
                                type="password" class="form-input" id="conf-pwd" required /></div>
                        <button type="submit" class="btn btn-primary"><i class="fas fa-key"></i> Update
                            Password</button>
                    </form>
                </div>
            </div>
        </main>
    </div>

    <script src="js/api.js?v=2"></script>
    <script src="js/auth.js"></script>
    <script>
        if (!Auth.isLoggedIn()) window.location.href = 'login.html';
        const user = Auth.getUser();

        function switchTab(tab, btn) {
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            btn.classList.add('active');
            document.getElementById('tab-' + tab).classList.add('active');
        }

        // Load profile
        async function loadProfile() {
            try {
                const data = await API('/users/profile');
                const u = data.user;
                document.getElementById('sidebar-name').textContent = u.name;
                document.getElementById('sidebar-email').textContent = u.email;
                document.getElementById('sidebar-avatar').textContent = u.name.charAt(0).toUpperCase();
                document.getElementById('profile-avatar').textContent = u.name.charAt(0).toUpperCase();
                document.getElementById('avatar-name').textContent = u.name;
                document.getElementById('avatar-email').textContent = u.email;
                document.getElementById('member-since').textContent = new Date(u.createdAt).toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
                document.getElementById('pf-name').value = u.name || '';
                document.getElementById('pf-phone').value = u.phone || '';
                document.getElementById('pf-email').value = u.email || '';
                if (u.address) {
                    document.getElementById('addr-street').value = u.address.street || '';
                    document.getElementById('addr-city').value = u.address.city || '';
                    document.getElementById('addr-state').value = u.address.state || '';
                    document.getElementById('addr-zip').value = u.address.zip || '';
                    document.getElementById('addr-country').value = u.address.country || 'BD';
                }
            } catch (e) {
                if (user) { document.getElementById('pf-name').value = user.name; document.getElementById('pf-email').value = user.email; }
            }
        }
        loadProfile();

        document.getElementById('profile-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = e.target.querySelector('button[type=submit]');
            btn.disabled = true; btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving...';
            try {
                await API('/users/profile', 'PUT', { name: document.getElementById('pf-name').value, phone: document.getElementById('pf-phone').value });
                showToast('Profile updated successfully!', 'success');
            } catch (err) { document.getElementById('profile-alert').innerHTML = `<div class="alert alert-danger">${err.message}</div>`; }
            btn.disabled = false; btn.innerHTML = '<i class="fas fa-save"></i> Save Changes';
        });

        document.getElementById('address-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            try {
                await API('/users/profile', 'PUT', { address: { street: document.getElementById('addr-street').value, city: document.getElementById('addr-city').value, state: document.getElementById('addr-state').value, zip: document.getElementById('addr-zip').value, country: document.getElementById('addr-country').value } });
                showToast('Address saved!', 'success');
            } catch (err) { document.getElementById('address-alert').innerHTML = `<div class="alert alert-danger">${err.message}</div>`; }
        });

        document.getElementById('password-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const np = document.getElementById('new-pwd').value;
            const cp = document.getElementById('conf-pwd').value;
            if (np !== cp) { document.getElementById('security-alert').innerHTML = '<div class="alert alert-danger">Passwords do not match</div>'; return; }
            try {
                await API('/users/change-password', 'PUT', { currentPassword: document.getElementById('cur-pwd').value, newPassword: np });
                showToast('Password updated successfully!', 'success');
                document.getElementById('password-form').reset();
            } catch (err) { document.getElementById('security-alert').innerHTML = `<div class="alert alert-danger">${err.message}</div>`; }
        });

        // Handle #security hash
        if (window.location.hash === '#security') { document.getElementById('security-tab').click(); }
    </script>
</body>

</html>