<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Product Detail â€” Binary Craft</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
    <link rel="stylesheet" href="css/global.css" />
    <link rel="stylesheet" href="css/navbar.css" />
    <link rel="stylesheet" href="css/footer.css" />
    <style>
        .prod-header {
            padding: 120px 0 60px;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border);
        }

        .prod-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 48px;
            padding: 60px 0;
        }

        .prod-image-box {
            width: 100%;
            aspect-ratio: 4/3;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            
            align-items: center;
            justify-content: center;
            font-size: 80px;
            position: relative;
            overflow: hidden;
        }

        .prod-badge-sale {
            position: absolute;
            top: 20px;
            left: 20px;
            background: var(--danger);
            color: #fff;
            font-size: 12px;
            font-weight: 700;
            padding: 4px 12px;
            border-radius: 4px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .prod-info {
            
            flex-direction: column;
        }

        .prod-cat {
            font-size: 13px;
            color: var(--primary);
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin-bottom: 12px;
        }

        .prod-title {
            font-size: 36px;
            font-weight: 800;
            color: var(--text-primary);
            margin-bottom: 16px;
            line-height: 1.2;
        }

        .prod-rating {
            
            align-items: center;
            gap: 8px;
            font-size: 14px;
            color: var(--warning);
            margin-bottom: 24px;
        }

        .prod-desc {
            font-size: 16px;
            color: var(--text-secondary);
            line-height: 1.7;
            margin-bottom: 32px;
        }

        .prod-price-box {
            
            align-items: flex-end;
            gap: 16px;
            margin-bottom: 32px;
        }

        .prod-price {
            font-size: 32px;
            font-weight: 900;
            color: var(--text-primary);
            line-height: 1;
        }

        .prod-price-old {
            font-size: 20px;
            color: var(--text-muted);
            text-decoration: line-through;
            margin-bottom: 4px;
        }

        .prod-actions {
            
            gap: 16px;
            margin-bottom: 40px;
        }

        .qty-select {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            color: var(--text-primary);
            padding: 0 20px;
            border-radius: var(--radius-md);
            font-size: 16px;
            font-weight: 600;
            outline: none;
        }

        .meta-table {
            width: 100%;
            border-collapse: collapse;
            border-top: 1px solid var(--border);
        }

        .meta-table tr {
            border-bottom: 1px solid var(--border);
        }

        .meta-table td {
            padding: 12px 0;
            font-size: 14px;
        }

        .meta-table td:first-child {
            color: var(--text-muted);
            width: 40%;
        }

        .meta-table td:last-child {
            color: var(--text-primary);
            font-weight: 500;
        }

        @media(max-width:900px) {
            .prod-container {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>

<body>
    <nav class="navbar" id="navbar">
        <div class="nav-container">
            <a href="index.html" class="nav-logo"><img src="images/logo.png" alt="Binary Craft Logo" style="height: 40px; margin-right: 12px;" /></a>
            <ul class="nav-links">
                <li><a href="index.html">Home</a></li>
                <li><a href="services.html">Services</a></li>
                <li><a href="products.html" class="active">Products</a></li>
                <li><a href="about.html">About</a></li>
                <li><a href="contact.html">Contact</a></li>
            </ul>
            <div class="nav-actions">
                <a href="cart.html" class="nav-cart"><i class="fas fa-shopping-cart"></i><span class="cart-badge"
                        id="cart-count">0</span></a>
                <a href="login.html" class="btn btn-primary" id="nav-auth-btn">Sign In</a>
                <button class="mobile-menu-btn"
                    onclick="document.querySelector('.nav-links').classList.toggle('active')"><i
                        class="fas fa-bars"></i></button>
            </div>
        </div>
    </nav>

    <div id="prod-wrapper">
        <div class="prod-header">
            <div class="container" style="text-align:center">
                <div class="spinner"></div>
            </div>
        </div>
    </div>

    <footer style="background:var(--bg-secondary);padding:60px 0;border-top:1px solid var(--border);">
        <div class="container">
            <p style="text-align:center;color:var(--text-muted)">&copy; 2023 Binary Craft.</p>
        </div>
    </footer>

    <script src="js/api.js?v=2"></script>
    <script src="js/auth.js"></script>
    <script src="js/cart.js"></script>
    <script>
        window.addEventListener('scroll', () => document.getElementById('navbar').classList.toggle('scrolled', window.scrollY > 50));
        if (Auth.isLoggedIn()) { const btn = document.getElementById('nav-auth-btn'); btn.textContent = 'Dashboard'; btn.href = 'dashboard.html'; btn.className = 'btn btn-outline'; }
        updateCartCount();

        async function loadProduct() {
            const urlParams = new URLSearchParams(window.location.search);
            const id = urlParams.get('id');
            const wrapper = document.getElementById('prod-wrapper');

            if (!id) { wrapper.innerHTML = '<div class="container" style="padding:100px 0;text-align:center"><h1>Product Not Found</h1><a href="products.html" class="btn btn-primary" style="margin-top:20px">Back to Shop</a></div>'; return; }

            try {
                const data = await API(`/products/${id}`);
                const p = data.product;
                document.title = `${p.title} â€” Binary Craft`;

                let tagsHtml = '';
                if (p.tags && p.tags.length > 0) tagsHtml = `<div class="prod-badge-sale">${p.tags[0]}</div>`;

                let priceHtml = '';
                if (p.discountPrice && p.discountPrice < p.price) {
                    priceHtml = `<span class="prod-price">$${p.discountPrice.toFixed(2)}</span><span class="prod-price-old">$${p.price.toFixed(2)}</span>`;
                } else {
                    priceHtml = `<span class="prod-price">$${p.price.toFixed(2)}</span>`;
                }

                const finalPrice = p.discountPrice || p.price;

                wrapper.innerHTML = `
          <div class="prod-header">
            <div class="container">
              <div class="breadcrumb" style="justify-content:flex-start"><a href="index.html">Home</a><span>/</span><a href="products.html">Products</a><span>/</span><span>${p.category}</span></div>
            </div>
          </div>
          
          <div class="container prod-container">
            <div class="prod-image-box">
              ${tagsHtml}
              ${p.icon || '<i class="fas fa-box"></i>'}
            </div>
            
            <div class="prod-info">
              <div class="prod-cat">${p.category}</div>
              <h1 class="prod-title">${p.title}</h1>
              <div class="prod-rating">
                <i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star-half-alt"></i>
                <span style="color:var(--text-muted);font-size:13px">(24 Reviews)</span>
              </div>
              
              <div class="prod-price-box">${priceHtml}</div>
              
              <p class="prod-desc">${p.description}</p>
              
              <div class="prod-actions">
                <select id="qty-sel" class="qty-select">
                  <option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option>
                </select>
                <button class="btn btn-primary" style="flex:1;justify-content:center;padding:16px;font-size:16px" onclick='addProdToCart(${JSON.stringify({ id: p._id, title: p.title, price: finalPrice, image: p.icon || "<i class='fas fa-box'></i>", type: "product" }).replace(/'/g, "&apos;")})'>
                  <i class="fas fa-shopping-cart"></i> Add to Cart
                </button>
              </div>
              
              <table class="meta-table">
                <tr><td>Format</td><td>Digital Download / Access</td></tr>
                <tr><td>License</td><td>Standard Commercial License</td></tr>
                <tr><td>Updates</td><td>Lifetime free updates</td></tr>
                <tr><td>Support</td><td>6 Months premium support</td></tr>
              </table>
            </div>
          </div>
        `;
            } catch (e) {
                wrapper.innerHTML = '<div class="container" style="padding:100px 0;text-align:center"><h1>Product Not Found</h1><p style="color:var(--danger)">' + e.message + '</p><a href="products.html" class="btn btn-primary" style="margin-top:20px">Back to Shop</a></div>';
            }
        }

        function addProdToCart(itemStr) {
            const item = typeof itemStr === 'string' ? JSON.parse(itemStr) : itemStr;
            const qty = parseInt(document.getElementById('qty-sel').value) || 1;
            let cart = JSON.parse(localStorage.getItem('bc_cart_local') || '[]');
            const extItem = cart.find(x => x.id === item.id);
            if (extItem) extItem.qty += qty;
            else { item.qty = qty; cart.push(item); }
            localStorage.setItem('bc_cart_local', JSON.stringify(cart));
            updateCartCount();
            showToast('Added ' + qty + ' item(s) to cart! ðŸ›’', 'success');
        }

        loadProduct();
    </script>
</body>

</html>