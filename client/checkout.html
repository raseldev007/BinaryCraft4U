<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Checkout â€” Binary Craft</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
    <link rel="stylesheet" href="css/global.css" />
    <link rel="stylesheet" href="css/navbar.css" />
    <style>
        body {
            background: var(--bg-primary);
            font-family: var(--font-primary);
            color: var(--text-primary);
        }

        .checkout-page {
            padding: 100px 0 80px;
            min-height: 100vh;
        }

        .checkout-page h1 {
            font-family: var(--font-heading);
            font-size: 40px;
            font-weight: 800;
            letter-spacing: -0.02em;
            margin-bottom: 32px;
        }

        .checkout-layout {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 40px;
            align-items: start;
        }

        .checkout-section {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            padding: 40px;
            margin-bottom: 32px;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        .checkout-section h3 {
            font-family: var(--font-heading);
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 32px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .checkout-section h3 i {
            color: var(--primary);
            font-size: 18px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
        }

        .form-group {
            margin-bottom: 24px;
        }

        .form-label {
            display: block;
            font-size: 13px;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        /* Payment Options */
        .payment-grid {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .payment-card {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 20px 24px;
            background: var(--bg-secondary);
            border: 2px solid var(--border);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: var(--transition);
            position: relative;
        }

        .payment-card:hover {
            border-color: var(--primary);
            background: rgba(255, 255, 255, 0.02);
        }

        .payment-card.selected {
            border-color: var(--primary);
            background: var(--primary-glow);
            box-shadow: var(--shadow-glow);
        }

        .payment-card input {
            position: absolute;
            opacity: 0;
        }

        .payment-icon {
            font-size: 24px;
            color: var(--primary);
        }

        .payment-info b {
            display: block;
            font-size: 15px;
            margin-bottom: 2px;
        }

        .payment-info span {
            font-size: 12px;
            color: var(--text-muted);
        }

        /* Order Summary sticky */
        .order-summary-box {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            padding: 32px;
            position: sticky;
            top: 40px;
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
        }

        .order-summary-box h3 {
            font-family: var(--font-heading);
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 24px;
        }

        .item-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid var(--border);
            font-size: 14px;
        }

        .item-row:last-of-type {
            border-bottom: none;
        }

        .total-row {
            margin-top: 24px;
            padding-top: 24px;
            border-top: 2px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-family: var(--font-heading);
            font-size: 24px;
            font-weight: 800;
        }

        /* Responsive */
        @media (max-width: 900px) {
            .checkout-layout {
                grid-template-columns: 1fr;
            }

            .order-summary-box {
                position: static;
            }

            .form-row {
                grid-template-columns: 1fr;
                gap: 0;
            }
        }
    </style>
</head>

<body>
    <nav class="navbar" id="navbar">
        <div class="nav-container">
            <a href="index.html" class="nav-logo"><img src="images/logo.png" alt="Binary Craft Logo"
                    style="height: 40px; margin-right: 12px;" /></a>
            <div style="display:flex;gap:12px;align-items:center">
                <span style="font-size:14px;color:var(--text-muted)"><i class="fas fa-lock"
                        style="color:var(--primary)"></i> Secure Checkout</span>
            </div>
        </div>
    </nav>

    <div class="checkout-page">
        <div class="container">
            <div style="margin-bottom:40px">
                <h1 style="margin-bottom:8px">Checkout</h1>
                <p style="color:var(--text-muted); font-size:16px;">Finalize your order and get started with Binary
                    Craft.</p>
            </div>

            <div class="checkout-layout">
                <div class="checkout-form-container">
                    <div id="checkout-alert"></div>
                    <form id="checkout-form">
                        <!-- Shipping Section -->
                        <div class="checkout-section">
                            <h3><i class="fas fa-map-marker-alt"></i> shipping Details</h3>
                            <div class="form-group">
                                <label class="form-label">Full Name</label>
                                <input type="text" class="form-input" id="sh-name" placeholder="John Doe" required />
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">Email Address</label>
                                    <input type="email" class="form-input" id="sh-email" placeholder="john@example.com"
                                        required />
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Phone Number</label>
                                    <input type="tel" class="form-input" id="sh-phone" placeholder="+880..." />
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Street Address</label>
                                <input type="text" class="form-input" id="sh-street"
                                    placeholder="House no, street name, area..." required />
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">City</label>
                                    <input type="text" class="form-input" id="sh-city" placeholder="e.g. Dhaka"
                                        required />
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Country</label>
                                    <select class="form-input" id="sh-country">
                                        <option value="BD">Bangladesh</option>
                                        <option value="US">United States</option>
                                        <option value="GB">United Kingdom</option>
                                        <option value="IN">India</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group" style="margin-bottom:0">
                                <label class="form-label">Order Notes (Optional)</label>
                                <textarea class="form-input" id="sh-notes" style="min-height:100px"
                                    placeholder="Any special instructions for your order..."></textarea>
                            </div>
                        </div>

                        <!-- Payment Section -->
                        <div class="checkout-section">
                            <h3><i class="fas fa-credit-card"></i> Payment Method</h3>
                            <div class="payment-grid">
                                <label class="payment-card selected" id="pm-cod">
                                    <input type="radio" name="payment" value="cod" checked />
                                    <div class="payment-icon"><i class="fas fa-money-bill-wave"></i></div>
                                    <div class="payment-info">
                                        <b>Cash on Delivery</b>
                                        <span>Pay after receiving the service or product.</span>
                                    </div>
                                </label>
                                <label class="payment-card" id="pm-bank">
                                    <input type="radio" name="payment" value="bank" />
                                    <div class="payment-icon"><i class="fas fa-university"></i></div>
                                    <div class="payment-info">
                                        <b>Bank Transfer</b>
                                        <span>Direct transfer to our corporate account.</span>
                                    </div>
                                </label>
                                <label class="payment-card" style="opacity: 0.5; cursor: not-allowed;">
                                    <input type="radio" name="payment" value="stripe" disabled />
                                    <div class="payment-icon"><i class="fab fa-stripe"></i></div>
                                    <div class="payment-info">
                                        <b>Credit Card <span class="badge badge-primary"
                                                style="font-size: 10px; margin-left: 5px;">Coming Soon</span></b>
                                        <span>Secure online payment via Stripe.</span>
                                    </div>
                                </label>
                            </div>
                        </div>
                    </form>
                </div>

                <!-- Summary Sticky -->
                <div class="order-summary-box">
                    <h3>Order Summary</h3>
                    <div id="summary-items-list">
                        <!-- Items injected by JS -->
                    </div>

                    <div class="total-row">
                        <span>Total Amount</span>
                        <span id="total-price" style="color: var(--primary)">$0.00</span>
                    </div>

                    <p style="font-size: 12px; color: var(--text-muted); margin: 20px 0; text-align: center;">
                        <i class="fas fa-shield-alt"></i> 256-bit SSL Secure Checkout
                    </p>

                    <button class="btn btn-primary btn-lg" style="width:100%; justify-content:center; padding: 20px;"
                        id="place-order-btn" onclick="placeOrder()">
                        <i class="fas fa-check-double"></i> Complete Order
                    </button>

                    <div style="margin-top: 16px; text-align: center;">
                        <a href="cart.html" style="color: var(--text-muted); font-size: 14px; text-decoration: none;">
                            <i class="fas fa-arrow-left"></i> Back to Cart
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="js/api.js?v=2"></script>
    <script src="js/auth.js"></script>
    <script>
        if (!Auth.isLoggedIn()) window.location.href = 'login.html?redirect=checkout.html';

        const cartItems = JSON.parse(localStorage.getItem('bc_cart_local') || '[]');
        if (cartItems.length === 0) window.location.href = 'cart.html';

        const user = Auth.getUser();
        if (user) {
            document.getElementById('sh-name').value = user.name || '';
            document.getElementById('sh-email').value = user.email || '';
        }

        // Render cart items in summary
        const total = cartItems.reduce((s, i) => s + i.price * i.qty, 0);
        document.getElementById('total-price').textContent = '$' + total.toFixed(2);
        document.getElementById('summary-items-list').innerHTML = cartItems.map(i => `
            <div class="item-row">
                <div style="display:flex; align-items:center; gap:10px">
                    <div style="font-size:18px">${i.image}</div>
                    <div>
                        <div style="font-weight:600; font-size:13px">${i.title}</div>
                        <div style="font-size:11px; color:var(--text-muted)">Qty: ${i.qty}</div>
                    </div>
                </div>
                <div style="font-weight:700">$${(i.price * i.qty).toFixed(2)}</div>
            </div>
        `).join('');

        // Payment option styling
        document.querySelectorAll('.payment-card').forEach(opt => {
            opt.addEventListener('click', () => {
                document.querySelectorAll('.payment-card').forEach(o => o.classList.remove('selected'));
                opt.classList.add('selected');
                opt.querySelector('input').checked = true;
            });
        });

        async function placeOrder() {
            const btn = document.getElementById('place-order-btn');
            const alertEl = document.getElementById('checkout-alert');
            const paymentMethod = document.querySelector('input[name=payment]:checked').value;
            alertEl.innerHTML = '';
            btn.disabled = true; btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Placing Order...';
            try {
                const data = await API('/orders', 'POST', {
                    shippingAddress: { street: document.getElementById('sh-street').value, city: document.getElementById('sh-city').value, country: document.getElementById('sh-country').value },
                    notes: document.getElementById('sh-notes').value,
                    paymentMethod
                });
                localStorage.removeItem('bc_cart_local');
                localStorage.removeItem('bc_cart_count');
                showToast('Order placed successfully! ðŸŽ‰', 'success');
                setTimeout(() => window.location.href = 'dashboard.html', 1500);
            } catch (err) {
                alertEl.innerHTML = `<div class="alert alert-danger">${err.message}</div>`;
                btn.disabled = false; btn.innerHTML = '<i class="fas fa-check-circle"></i> Place Order';
            }
        }

        window.addEventListener('scroll', () => document.getElementById('navbar').classList.toggle('scrolled', window.scrollY > 50));
    </script>
</body>

</html>